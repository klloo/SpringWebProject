<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.huiy.mapper.BoardMapper">
	<select id="getListWithPaging" resultType="com.huiy.domain.BoardVO">
 		<![CDATA[
			select bno,title,content,writer,regdate,updatedate,viewcnt,isanonymous
			from (
			 select /*+INDEX_DESC(tbl_board pk_board)*/
			  rownum rn,bno,title,content,writer,regdate,updatedate,viewcnt,isanonymous
			 from tbl_board
			 where rownum <= #{pageNum} * #{amount}
			)
			where rn > (#{pageNum}-1) * #{amount}
 		]]> 
    </select>
    
    <select id="getListWithUserPaging" resultType="com.huiy.domain.BoardVO">
		<![CDATA[
			select bno,title,content,writer,regdate,updatedate,viewcnt,isanonymous
			from (
			 select /*+INDEX_DESC(tbl_board pk_board)*/
			  rownum rn,bno,title,content,writer,regdate,updatedate,viewcnt,isanonymous
			 from tbl_board
			 where rownum <= #{cri.pageNum} * #{cri.amount}
			 and userid=#{userid}
			)
			where rn > (#{cri.pageNum}-1) * #{cri.amount}
 		]]> 
    </select>
    
    <insert id="insert">
 		insert into tbl_board (bno,title,content,writer,userid,isanonymous)
 		values(SEQ_BOARD.nextval,#{title},#{content},#{writer},#{userid},#{isanonymous})
    </insert>
    
    
    <insert id="insertSelectKey">
    	<selectKey keyProperty="bno" order="AFTER" resultType="long">
    		select seq_board.currval from dual
    	</selectKey>
   		insert into tbl_board (bno,title,content,writer,userid,isanonymous)
 		values(SEQ_BOARD.nextval,#{title},#{content},#{writer},#{userid},#{isanonymous})
    </insert>
    	
    <select id="read" resultType="com.huiy.domain.BoardVO">
 		select * from tbl_board where bno = #{bno}
    </select>
    	
    <update id="update">
 		update tbl_board
    	set
    	title = #{title},
    	content = #{content},
    	isanonymous = #{isanonymous},
    	updatedate = sysdate
    	where bno = #{bno}
    </update>
    
    	
    <update id="updateViewcnt">
 		update tbl_board
    	set
		viewcnt = viewcnt+1
    	where bno = #{bno}
    </update>
    	
    <delete id="delete">
 		delete from tbl_board where bno = #{bno}	
    </delete>
</mapper>